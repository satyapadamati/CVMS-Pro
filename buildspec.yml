version: 0.2

phases:
  pre_build:
    commands:
      - echo Logging in to Docker Hub...
      - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_USERNAME" --password-stdin
      - IMAGE_TAG=$(date +%s)
  
  build:
    commands:
      - echo Using existing Docker image from Docker Hub...
      - docker pull satya368/autocare_img:latest
      - docker tag satya368/autocare_img:latest satya368/autocare_img:$IMAGE_TAG
  
  post_build:
    commands:
      - echo Writing Dockerrun.aws.json file...
      - echo '{
          "AWSEBDockerrunVersion": "1",
          "Image": {
            "Name": "satya368/autocare_img:'$IMAGE_TAG'",
            "Update": "true"
          },
          "Ports": [
            {
              "ContainerPort": "80"
            }
          ]
        }' > Dockerrun.aws.json
      - echo Build completed on `date`

artifacts:
  files:
    - Dockerrun.aws.json
